---
title: "NBA 24/25 season Portfolio"
author: Shrivas Shankar
  
output: rmdformats::robobook
---

```{r, echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

```

```{r}
```{r, fig.width=8, fig.height=6}
library(dplyr)
library(lubridate)
library(ggplot2)
library(ggimage)
library(patchwork)
library(showtext)

# Font setup
font_add_google("Lato", "Lato")
showtext_auto()

# Load and prep data
stats_all <- read.csv(
  "~/Desktop/Stat 240/data/PlayerStatistics.csv",
  stringsAsFactors = FALSE
) %>%
  mutate(
    GameDate = ymd_hms(gameDate),
    Player   = paste(firstName, lastName)
  )

all_stars <- c(
  "Luka Dončić", "Giannis Antetokounmpo", "Joel Embiid", "Nikola Jokić",
  "Shai Gilgeous-Alexander", "Jayson Tatum", "Anthony Davis", "LeBron James",
  "Damian Lillard", "Stephen Curry", "Devin Booker", "DeMar DeRozan",
  "Zion Williamson", "Tyrese Haliburton", "De’Aaron Fox", "Karl-Anthony Towns",
  "Trae Young", "Zach LaVine", "Kyrie Irving", "Pascal Siakam"
)

stats_rs_2425 <- stats_all %>%
  filter(
    GameDate >= as_datetime("2024-10-22"),
    GameDate <= as_datetime("2025-04-13"),
    gameType == "Regular Season",
    Player %in% all_stars
  )
 
# WIN RATE ranking
win_rate_df <- stats_rs_2425 %>%
  group_by(Player) %>%
  summarise(win_rate = mean(win, na.rm = TRUE)) %>%
  arrange(desc(win_rate))

# AVG POINTS ranking
summary_pts <- stats_rs_2425 %>%
  group_by(Player) %>%
  summarise(avg_points = mean(points, na.rm = TRUE)) %>%
  arrange(desc(avg_points))

# PLUS/MINUS ranking
plus_order <- stats_rs_2425 %>%
  group_by(Player) %>%
  summarise(avg_pm = mean(plusMinusPoints, na.rm = TRUE)) %>%
  arrange(desc(avg_pm)) %>%
  pull(Player)

# So it appears in order from highest to lowest
win_rate_df <- win_rate_df %>%
  mutate(Player = factor(Player, levels = rev(win_rate_df$Player)))

summary_pts <- summary_pts %>%
  mutate(Player = factor(Player, levels = rev(summary_pts$Player)))

plus_minus_df <- stats_rs_2425 %>%
  mutate(Player = factor(Player, levels = rev(plus_order)))

headshots <- c(
  "Giannis Antetokounmpo"   = "https://cdn.nba.com/headshots/nba/latest/1040x760/203507.png",
  "Stephen Curry"           = "https://cdn.nba.com/headshots/nba/latest/1040x760/201939.png",
  "LeBron James"            = "https://cdn.nba.com/headshots/nba/latest/1040x760/2544.png",
  "Luka Dončić"             = "https://cdn.nba.com/headshots/nba/latest/1040x760/1629029.png",
  "Joel Embiid"             = "https://cdn.nba.com/headshots/nba/latest/1040x760/203954.png",
  "Nikola Jokić"            = "https://cdn.nba.com/headshots/nba/latest/1040x760/203999.png",
  "Shai Gilgeous-Alexander" = "https://cdn.nba.com/headshots/nba/latest/1040x760/1628983.png",
  "Jayson Tatum"            = "https://cdn.nba.com/headshots/nba/latest/1040x760/1628369.png",
  "Anthony Davis"           = "https://a.espncdn.com/combiner/i?img=/i/headshots/nba/players/full/6583.png&w=350&h=254",
  "Damian Lillard"          = "https://cdn.nba.com/headshots/nba/latest/1040x760/203081.png",
  "Devin Booker"            = "https://cdn.nba.com/headshots/nba/latest/1040x760/1626164.png",
  "DeMar DeRozan"           = "https://cdn.nba.com/headshots/nba/latest/1040x760/201942.png",
  "Zion Williamson"         = "https://cdn.nba.com/headshots/nba/latest/1040x760/1629627.png",
  "Tyrese Haliburton"       = "https://cdn.nba.com/headshots/nba/latest/1040x760/1630169.png",
  "De’Aaron Fox"            = "https://cdn.nba.com/headshots/nba/latest/1040x760/1628368.png",
  "Karl-Anthony Towns"      = "https://cdn.nba.com/headshots/nba/latest/1040x760/1626157.png",
  "Trae Young"              = "https://cdn.nba.com/headshots/nba/latest/1040x760/1629027.png",
  "Zach LaVine"             = "https://cdn.nba.com/headshots/nba/latest/1040x760/203897.png",
  "Kyrie Irving"            = "https://cdn.nba.com/headshots/nba/latest/1040x760/202681.png",
  "Pascal Siakam"           = "https://cdn.nba.com/headshots/nba/latest/1040x760/1627783.png"
)

win_rate_df <- win_rate_df %>% mutate(headshot = headshots[as.character(Player)])
summary_pts <- summary_pts %>% mutate(headshot = headshots[as.character(Player)])

# Plot 1: Win Rate
win_plot <- ggplot(win_rate_df, aes(x = Player, y = win_rate)) +
  geom_col(width = 0.6, fill = "skyblue", alpha = 0.8) +
  geom_image(aes(image = headshot), size = 0.08, by = "width") +
  coord_flip() +
  scale_x_discrete(expand = expansion(add = c(1.2, 1))) +
  labs(title = "Win Rates", x = NULL, y = "Win Rate") +
  theme_minimal(base_family = "Lato") +
  theme(axis.text.y = element_text(margin = margin(r = 6), size = 6))

# Plot 2: Avg Points
avg_plot <- ggplot(summary_pts, aes(x = Player, y = avg_points)) +
  geom_col(width = 0.6, fill = "pink", alpha = 0.8) +
  geom_image(aes(image = headshot), size = 0.06, by = "width") +
  coord_flip() +
  scale_x_discrete(expand = expansion(add = c(1.2, 1))) +
  labs(title = "Avg Points/Game by All-Star", x = NULL, y = "Avg PTS") +
  theme_minimal(base_family = "Lato") +
  theme(axis.text.y = element_text(margin = margin(r = 6), size = 6))

# Plot 3: Plus/Minus (sorted by average)
plus_plot <- ggplot(plus_minus_df, aes(x = Player, y = plusMinusPoints)) +
  geom_boxplot(width = 0.6, fill = "lightgreen", alpha = 0.7) +
  coord_flip() +
  scale_x_discrete(expand = expansion(add = c(1.2, 1))) +
  labs(title = "Plus/Minus Distribution", x = NULL, y = "+/–") +
  theme_minimal(base_family = "Lato") +
  theme(axis.text.y = element_text(margin = margin(r = 6), size = 6))

# Combine plots
(win_plot | avg_plot) / plus_plot +
  plot_layout(heights = c(1, 1.25)) +
  plot_annotation(
    title = "2024-25 All-Star Performance Summary",
    theme = theme(
      text = element_text(family = "Lato", size = 13),
      plot.title = element_text(size = 20, face = "bold"),
      plot.background = element_rect(fill = "#FAF8F3", color = NA)
    )
  )


```
